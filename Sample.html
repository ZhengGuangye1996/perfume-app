<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>毎日香水選び</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f4f4;
      padding: 30px;
    }

    .container {
      background: white;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
    }

    select, button {
      width: 100%;
      padding: 10px;
      margin-top: 15px;
      font-size: 16px;
    }

    button:hover {
      background-color: #cceeff;
      cursor: pointer;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
    }

    .perfume-image {
      max-width: 100%;
      margin-top: 10px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>毎日香水選び</h2>

    <label for="purpose">出かける目的:</label>
    <select id="purpose">
      <option value="">--選択--</option>
      <option value="デート">デート</option>
      <option value="仕事">仕事</option>
      <option value="買い物">買い物</option>
      <option value="イベント">イベント</option>
    </select>

    <label for="time">出かける時間帯:</label>
    <select id="time">
      <option value="">--選択--</option>
      <option value="朝">朝</option>
      <option value="昼">昼</option>
      <option value="夕方">夕方</option>
      <option value="夜">夜</option>
    </select>

    <button onclick="recommendPerfume()">おすすめを表示</button>

    <div class="result" id="result"></div>
  </div>

  <script>
    const categoryColors = {
      "グリーン": "lightgreen",
      "アクアティック": "lightblue",
      "フローラル": "pink",
      "フルーティー": "lightyellow",
      "バルサミック": "wheat",
      "フレッシュ": "honeydew",
      "シトラス": "lemonchiffon",
      "ウッディ": "burlywood",
      "ムスク": "lavender",
      "スモーク": "lightgray"
    };

    const perfumeSelect = {
      "フルーティー": [
        { name: "Eau de Campagne", desc: "爽やかなフルーティーの香り", img: "" },
        { name: "Cap Neroli", desc: "柑橘と花のバランス", img: "" },
        { name: "Oyedo", desc: "柚子ベースの日本的香水", img: "" }
      ],
      "グリーン": [
        { name: "Yulong", desc: "緑茶のような香り", img: "" },
        { name: "LES FLEURS", desc: "自然な草木の香り", img: "" }
      ],
      "フローラル": [
        { name: "Mandorlo di Sicilia", desc: "甘く優しい花の香り", img: "" },
        { name: "Fig Tea", desc: "無花果と紅茶の香り", img: "" },
        { name: "Eau d'Ete", desc: "軽やかな花々の香り", img: "" }
      ],
      "バルサミック": [
        { name: "Des Clous Pour Une Pelure", desc: "濃厚で温かみのある香り", img: "" },
        { name: "Encre Noire", desc: "深くスモーキーな香り", img: "" }
      ],
      "フレッシュ": [
        { name: "Laine de Verre", desc: "清潔感ある軽快な香り", img: "" },
        { name: "Virgin Island Water", desc: "海辺のような爽やかさ", img: "" }
      ],
      "アクアティック": [
        { name: "Mirto di panarea", desc: "潮風を感じる海の香り", img: "" }
      ],
      "シトラス": [
        { name: "Yuzu", desc: "柚子のフレッシュな香り", img: "" },
        { name: "Orange Crush", desc: "明るい柑橘系", img: "" }
      ],
      "ウッディ": [
        { name: "Gaiac 10 Tokyo", desc: "ウッディで大人の香り", img: "" },
        { name: "New York", desc: "都会的な木の香り", img: "" }
      ],
      "ムスク": [
        { name: "Des Clous Pour Une Pelure", desc: "やわらかなムスク香", img: "" }
      ],
      "スモーク": [
        { name: "Vetiver d'Hiver", desc: "スモーキーで奥深い香り", img: "" }
      ]
    };

    const purposeTimeSelect = {
      "デート朝": ["フローラル", "フルーティー"],
      "デート昼": ["フローラル", "シトラス"],
      "デート夕方": ["ムスク", "バルサミック"],
      "デート夜": ["ムスク", "スモーク"],
      "仕事朝": ["フレッシュ", "グリーン"],
      "仕事昼": ["フレッシュ", "ウッディ"],
      "仕事夕方": ["ウッディ", "バルサミック"],
      "仕事夜": ["ウッディ", "ムスク"],
      "買い物朝": ["シトラス", "グリーン"],
      "買い物昼": ["フルーティー", "シトラス"],
      "買い物夕方": ["フローラル", "ウッディ"],
      "買い物夜": ["バルサミック", "ムスク"],
      "イベント朝": ["フローラル", "シトラス"],
      "イベント昼": ["フルーティー", "フローラル"],
      "イベント夕方": ["スモーク", "バルサミック"],
      "イベント夜": ["スモーク", "ムスク"]
    };

    async function recommendPerfume() {
      const purpose = document.getElementById("purpose").value;
      const time = document.getElementById("time").value;
      const resultDiv = document.getElementById("result");

      if (!purpose || !time) {
        resultDiv.innerHTML = "目的と時間帯を選択してください。";
        return;
      }

      let weather = "不明";
      let temperature = "";
      let season = "春";

      try {
        const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej));
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        const apiKey = "b85fcd53bdf5d0561919887add77554d"; // ← ご自身のAPIキーに差し替えてください
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=ja`;
        const res = await fetch(url);
        const data = await res.json();

        weather = data.weather[0].main;
        temperature = `${data.main.temp}℃`;

        const month = new Date().getMonth() + 1;
        if (month >= 3 && month <= 5) season = "春";
        else if (month >= 6 && month <= 8) season = "夏";
        else if (month >= 9 && month <= 11) season = "秋";
        else season = "冬";
      } catch (e) {
        console.error("天気取得に失敗", e);
      }

      const scents = purposeTimeSelect[`${purpose}${time}`] || [];
      const selectedScent = scents[Math.floor(Math.random() * scents.length)];
      const perfumeList = perfumeSelect[selectedScent] || [];
      const perfume = perfumeList[Math.floor(Math.random() * perfumeList.length)];

      resultDiv.style.backgroundColor = categoryColors[selectedScent] || "#e6ffe6";
      resultDiv.innerHTML = `
        <strong>今日のおすすめ香水</strong><br>
        季節: ${season}<br>
        天気: ${weather}<br>
        気温: ${temperature}<br>
        目的: ${purpose}<br>
        時間帯: ${time}<br>
        香りカテゴリ: ${selectedScent}<br>
        香水: <strong>${perfume.name}</strong><br>
        説明: ${perfume.desc}<br>
        <img src="${perfume.img}" class="perfume-image"><br>
      `;
    }
  </script>
</body>
</html>
